---
# Code generated by tools/dashgen; DO NOT EDIT.
apiVersion: monitoring.coreos.com/v1
kind: PrometheusRule
metadata:
  name: spt-alerts
  labels:
    prometheus: system-rules-prometheus
spec:
  groups:
    - name: spt-alerts
      rules:
        - alert: SptDown
          expr: absent(up{job="server-price-tracker"})
          for: 2m
          labels:
            severity: critical
          annotations:
            description: The server-price-tracker job has been absent for more than 2 minutes.
            summary: Server Price Tracker is down
        - alert: SptReadinessDown
          expr: spt_readyz_up == 0
          for: 2m
          labels:
            severity: critical
          annotations:
            description: The readiness probe has been reporting not-ready for more than 2 minutes.
            summary: Server Price Tracker readiness check is failing
        - alert: SptHighErrorRate
          expr: spt:http_errors:rate5m / spt:http_requests:rate5m > 0.05
          for: 5m
          labels:
            severity: warning
          annotations:
            description: More than 5% of HTTP requests are returning 5xx errors over the last 5 minutes.
            summary: High HTTP error rate on Server Price Tracker
        - alert: SptIngestionErrors
          expr: spt:ingestion_errors:rate5m > 0
          for: 5m
          labels:
            severity: warning
          annotations:
            description: The ingestion pipeline has been producing errors for more than 5 minutes.
            summary: Ingestion errors detected
        - alert: SptExtractionFailures
          expr: spt:extraction_failures:rate5m > 0.1
          for: 5m
          labels:
            severity: warning
          annotations:
            description: Extraction failures are occurring at more than 0.1/s for the last 5 minutes.
            summary: LLM extraction failure rate is elevated
        - alert: SptEbayQuotaHigh
          expr: spt_ebay_rate_remaining < 1000
          for: 5m
          labels:
            severity: warning
          annotations:
            description: Fewer than 1000 eBay API calls remain in the current quota window (from Analytics API).
            summary: eBay API quota is running low
        - alert: SptEbayLimitReached
          expr: increase(spt_ebay_daily_limit_hits_total[5m]) > 0
          for: 0m
          labels:
            severity: critical
          annotations:
            description: The eBay Browse API daily quota has been exhausted. Ingestion is paused until reset.
            summary: eBay API daily limit has been reached
        - alert: SptNotificationFailures
          expr: increase(spt_notification_failures_total[5m]) > 0
          for: 1m
          labels:
            severity: warning
          annotations:
            description: One or more alert notifications (Discord webhooks) have failed to send.
            summary: Notification delivery failures detected
        - alert: SptNoIngestionRecent
          expr: time() - spt_ingestion_last_success_timestamp > 1800
          for: 5m
          labels:
            severity: warning
          annotations:
            description: No successful ingestion cycle in the last 30 minutes.
            summary: No successful ingestion cycle recently
        - alert: SptPendingAlertBacklog
          expr: spt_alerts_pending > 50
          for: 10m
          labels:
            severity: warning
          annotations:
            description: More than 50 alerts are pending notification delivery.
            summary: Pending alert backlog is growing
        - alert: SptNotificationSilence
          expr: time() - spt_notification_last_success_timestamp > 86400
          for: 5m
          labels:
            severity: warning
          annotations:
            description: No successful notification has been sent in 24 hours.
            summary: No successful notifications in 24 hours
        - alert: SptLowBaselineCoverage
          expr: spt_baselines_warm / (spt_baselines_warm + spt_baselines_cold + spt_product_keys_no_baseline) < 0.5
          for: 30m
          labels:
            severity: info
          annotations:
            description: Fewer than 50% of product keys have warm baselines.
            summary: Low baseline coverage
