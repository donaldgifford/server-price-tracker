{
  "uid": "spt-overview",
  "title": "SPT Overview",
  "tags": [
    "spt",
    "server-price-tracker"
  ],
  "timezone": "browser",
  "editable": true,
  "graphTooltip": 1,
  "time": {
    "from": "now-6h",
    "to": "now"
  },
  "fiscalYearStartMonth": 0,
  "refresh": "30s",
  "schemaVersion": 41,
  "panels": [
    {
      "type": "row",
      "collapsed": true,
      "title": "Overview",
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 0
      },
      "id": 0,
      "panels": [
        {
          "type": "stat",
          "targets": [
            {
              "expr": "spt_healthz_up{job=\"server-price-tracker\"}",
              "legendFormat": "",
              "refId": "A"
            }
          ],
          "title": "Healthz",
          "description": "Health check status (1 = ok, 0 = failing)",
          "transparent": false,
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "gridPos": {
            "h": 4,
            "w": 6,
            "x": 0,
            "y": 1
          },
          "repeatDirection": "h",
          "options": {
            "graphMode": "none",
            "colorMode": "background",
            "justifyMode": "auto",
            "textMode": "value",
            "wideLayout": true,
            "showPercentChange": false,
            "reduceOptions": {
              "calcs": []
            },
            "percentChangeColorMode": "standard",
            "orientation": ""
          },
          "fieldConfig": {
            "defaults": {
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "value": null,
                    "color": "red"
                  },
                  {
                    "value": 1,
                    "color": "green"
                  }
                ]
              },
              "color": {
                "mode": "thresholds"
              }
            },
            "overrides": []
          }
        },
        {
          "type": "stat",
          "targets": [
            {
              "expr": "spt_readyz_up{job=\"server-price-tracker\"}",
              "legendFormat": "",
              "refId": "A"
            }
          ],
          "title": "Readyz",
          "description": "Readiness check status (1 = ready, 0 = not ready)",
          "transparent": false,
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "gridPos": {
            "h": 4,
            "w": 6,
            "x": 6,
            "y": 1
          },
          "repeatDirection": "h",
          "options": {
            "graphMode": "none",
            "colorMode": "background",
            "justifyMode": "auto",
            "textMode": "value",
            "wideLayout": true,
            "showPercentChange": false,
            "reduceOptions": {
              "calcs": []
            },
            "percentChangeColorMode": "standard",
            "orientation": ""
          },
          "fieldConfig": {
            "defaults": {
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "value": null,
                    "color": "red"
                  },
                  {
                    "value": 1,
                    "color": "green"
                  }
                ]
              },
              "color": {
                "mode": "thresholds"
              }
            },
            "overrides": []
          }
        },
        {
          "type": "gauge",
          "targets": [
            {
              "expr": "spt_ebay_daily_usage{job=\"server-price-tracker\"} / 5000 * 100",
              "legendFormat": "",
              "refId": "A"
            }
          ],
          "title": "eBay Quota %",
          "description": "Daily eBay API usage as percentage of limit",
          "transparent": false,
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "gridPos": {
            "h": 4,
            "w": 6,
            "x": 12,
            "y": 1
          },
          "repeatDirection": "h",
          "fieldConfig": {
            "defaults": {
              "unit": "percent",
              "min": 0,
              "max": 100,
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "value": null,
                    "color": "green"
                  },
                  {
                    "value": 80,
                    "color": "yellow"
                  },
                  {
                    "value": 95,
                    "color": "red"
                  }
                ]
              },
              "color": {
                "mode": "thresholds"
              }
            },
            "overrides": []
          }
        },
        {
          "type": "stat",
          "targets": [
            {
              "expr": "time() - process_start_time_seconds{job=\"server-price-tracker\"}",
              "legendFormat": "",
              "refId": "A"
            }
          ],
          "title": "Uptime",
          "description": "Time since process start",
          "transparent": false,
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "gridPos": {
            "h": 4,
            "w": 6,
            "x": 18,
            "y": 1
          },
          "repeatDirection": "h",
          "options": {
            "graphMode": "none",
            "colorMode": "value",
            "justifyMode": "auto",
            "textMode": "auto",
            "wideLayout": true,
            "showPercentChange": false,
            "reduceOptions": {
              "calcs": []
            },
            "percentChangeColorMode": "standard",
            "orientation": ""
          },
          "fieldConfig": {
            "defaults": {
              "unit": "s",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "value": null,
                    "color": "green"
                  }
                ]
              },
              "color": {
                "mode": "thresholds"
              }
            },
            "overrides": []
          }
        }
      ]
    },
    {
      "type": "row",
      "collapsed": true,
      "title": "HTTP",
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 5
      },
      "id": 0,
      "panels": [
        {
          "type": "timeseries",
          "targets": [
            {
              "expr": "spt:http_requests:rate5m",
              "legendFormat": "req/s",
              "refId": "A"
            }
          ],
          "title": "Request Rate",
          "description": "HTTP requests per second",
          "transparent": false,
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 6
          },
          "repeatDirection": "h",
          "options": {
            "legend": {
              "displayMode": "table",
              "placement": "bottom",
              "showLegend": false,
              "calcs": [
                "mean",
                "max"
              ]
            },
            "tooltip": {
              "mode": "multi",
              "sort": "desc"
            }
          },
          "fieldConfig": {
            "defaults": {
              "unit": "reqps",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "value": null,
                    "color": "green"
                  }
                ]
              },
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "drawStyle": "line",
                "lineWidth": 2,
                "fillOpacity": 10
              }
            },
            "overrides": []
          }
        },
        {
          "type": "timeseries",
          "targets": [
            {
              "expr": "histogram_quantile(0.50, sum(rate(spt_http_request_duration_seconds_bucket{job=\"server-price-tracker\"}[5m])) by (le))",
              "legendFormat": "p50",
              "refId": "A"
            },
            {
              "expr": "histogram_quantile(0.95, sum(rate(spt_http_request_duration_seconds_bucket{job=\"server-price-tracker\"}[5m])) by (le))",
              "legendFormat": "p95",
              "refId": "B"
            },
            {
              "expr": "histogram_quantile(0.99, sum(rate(spt_http_request_duration_seconds_bucket{job=\"server-price-tracker\"}[5m])) by (le))",
              "legendFormat": "p99",
              "refId": "C"
            }
          ],
          "title": "Latency Percentiles",
          "description": "HTTP request duration percentiles",
          "transparent": false,
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 6
          },
          "repeatDirection": "h",
          "options": {
            "legend": {
              "displayMode": "table",
              "placement": "bottom",
              "showLegend": false,
              "calcs": [
                "mean",
                "max"
              ]
            },
            "tooltip": {
              "mode": "multi",
              "sort": "desc"
            }
          },
          "fieldConfig": {
            "defaults": {
              "unit": "s",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "value": null,
                    "color": "green"
                  }
                ]
              },
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "drawStyle": "line",
                "lineWidth": 2,
                "fillOpacity": 10
              }
            },
            "overrides": []
          }
        },
        {
          "type": "timeseries",
          "targets": [
            {
              "expr": "spt:http_errors:rate5m / spt:http_requests:rate5m * 100",
              "legendFormat": "error %",
              "refId": "A"
            }
          ],
          "title": "Error Rate %",
          "description": "HTTP 5xx error rate as percentage of total requests",
          "transparent": false,
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 14
          },
          "repeatDirection": "h",
          "fieldConfig": {
            "defaults": {
              "unit": "percent",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "value": null,
                    "color": "green"
                  },
                  {
                    "value": 1,
                    "color": "yellow"
                  },
                  {
                    "value": 5,
                    "color": "red"
                  }
                ]
              },
              "color": {
                "mode": "thresholds"
              },
              "custom": {
                "drawStyle": "line",
                "lineWidth": 2,
                "fillOpacity": 10
              }
            },
            "overrides": []
          }
        }
      ]
    },
    {
      "type": "row",
      "collapsed": true,
      "title": "eBay API",
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 22
      },
      "id": 0,
      "panels": [
        {
          "type": "timeseries",
          "targets": [
            {
              "expr": "spt:ebay_api_calls:rate5m",
              "legendFormat": "calls/s",
              "refId": "A"
            }
          ],
          "title": "API Calls Rate",
          "description": "eBay Browse API calls per second",
          "transparent": false,
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "gridPos": {
            "h": 8,
            "w": 8,
            "x": 0,
            "y": 23
          },
          "repeatDirection": "h",
          "fieldConfig": {
            "defaults": {
              "unit": "reqps",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "value": null,
                    "color": "green"
                  }
                ]
              },
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "drawStyle": "line",
                "lineWidth": 2,
                "fillOpacity": 10
              }
            },
            "overrides": []
          }
        },
        {
          "type": "timeseries",
          "targets": [
            {
              "expr": "spt_ebay_daily_usage{job=\"server-price-tracker\"}",
              "legendFormat": "usage",
              "refId": "A"
            }
          ],
          "title": "Daily Usage vs Limit",
          "description": "Rolling 24h eBay API call count (limit: 5000)",
          "transparent": false,
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "gridPos": {
            "h": 8,
            "w": 8,
            "x": 8,
            "y": 23
          },
          "repeatDirection": "h",
          "fieldConfig": {
            "defaults": {
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "value": null,
                    "color": "green"
                  },
                  {
                    "value": 4000,
                    "color": "yellow"
                  },
                  {
                    "value": 5000,
                    "color": "red"
                  }
                ]
              },
              "color": {
                "mode": "thresholds"
              },
              "custom": {
                "drawStyle": "line",
                "lineWidth": 2,
                "fillOpacity": 10
              }
            },
            "overrides": []
          }
        },
        {
          "type": "stat",
          "targets": [
            {
              "expr": "increase(spt_ebay_daily_limit_hits_total{job=\"server-price-tracker\"}[24h])",
              "legendFormat": "",
              "refId": "A"
            }
          ],
          "title": "Limit Hits (24h)",
          "description": "Times the eBay daily limit was reached in the last 24 hours",
          "transparent": false,
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "gridPos": {
            "h": 8,
            "w": 8,
            "x": 16,
            "y": 23
          },
          "repeatDirection": "h",
          "options": {
            "graphMode": "area",
            "colorMode": "background",
            "justifyMode": "auto",
            "textMode": "auto",
            "wideLayout": true,
            "showPercentChange": false,
            "reduceOptions": {
              "calcs": []
            },
            "percentChangeColorMode": "standard",
            "orientation": ""
          },
          "fieldConfig": {
            "defaults": {
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "value": null,
                    "color": "green"
                  },
                  {
                    "value": 1,
                    "color": "yellow"
                  },
                  {
                    "value": 3,
                    "color": "red"
                  }
                ]
              },
              "color": {
                "mode": "thresholds"
              }
            },
            "overrides": []
          }
        }
      ]
    },
    {
      "type": "row",
      "collapsed": true,
      "title": "Ingestion",
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 31
      },
      "id": 0,
      "panels": [
        {
          "type": "timeseries",
          "targets": [
            {
              "expr": "spt:ingestion_listings:rate5m * 60",
              "legendFormat": "listings/min",
              "refId": "A"
            }
          ],
          "title": "Listings / min",
          "description": "Rate of listings ingested per minute",
          "transparent": false,
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "gridPos": {
            "h": 8,
            "w": 8,
            "x": 0,
            "y": 32
          },
          "repeatDirection": "h",
          "fieldConfig": {
            "defaults": {
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "value": null,
                    "color": "green"
                  }
                ]
              },
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "drawStyle": "line",
                "lineWidth": 2,
                "fillOpacity": 10
              }
            },
            "overrides": []
          }
        },
        {
          "type": "timeseries",
          "targets": [
            {
              "expr": "spt:ingestion_errors:rate5m * 60",
              "legendFormat": "errors/min",
              "refId": "A"
            }
          ],
          "title": "Errors / min",
          "description": "Rate of ingestion errors per minute",
          "transparent": false,
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "gridPos": {
            "h": 8,
            "w": 8,
            "x": 8,
            "y": 32
          },
          "repeatDirection": "h",
          "fieldConfig": {
            "defaults": {
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "value": null,
                    "color": "green"
                  },
                  {
                    "value": 0.1,
                    "color": "yellow"
                  },
                  {
                    "value": 1,
                    "color": "red"
                  }
                ]
              },
              "color": {
                "mode": "thresholds"
              },
              "custom": {
                "drawStyle": "line",
                "lineWidth": 2,
                "fillOpacity": 10
              }
            },
            "overrides": []
          }
        },
        {
          "type": "timeseries",
          "targets": [
            {
              "expr": "histogram_quantile(0.95, sum(rate(spt_ingestion_duration_seconds_bucket{job=\"server-price-tracker\"}[5m])) by (le))",
              "legendFormat": "p95",
              "refId": "A"
            }
          ],
          "title": "Cycle Duration (p95)",
          "description": "95th percentile ingestion cycle duration",
          "transparent": false,
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "gridPos": {
            "h": 8,
            "w": 8,
            "x": 16,
            "y": 32
          },
          "repeatDirection": "h",
          "fieldConfig": {
            "defaults": {
              "unit": "s",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "value": null,
                    "color": "green"
                  }
                ]
              },
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "drawStyle": "line",
                "lineWidth": 2,
                "fillOpacity": 10
              }
            },
            "overrides": []
          }
        }
      ]
    },
    {
      "type": "row",
      "collapsed": true,
      "title": "Extraction",
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 40
      },
      "id": 0,
      "panels": [
        {
          "type": "timeseries",
          "targets": [
            {
              "expr": "histogram_quantile(0.50, sum(rate(spt_extraction_duration_seconds_bucket{job=\"server-price-tracker\"}[5m])) by (le))",
              "legendFormat": "p50",
              "refId": "A"
            },
            {
              "expr": "histogram_quantile(0.95, sum(rate(spt_extraction_duration_seconds_bucket{job=\"server-price-tracker\"}[5m])) by (le))",
              "legendFormat": "p95",
              "refId": "B"
            }
          ],
          "title": "Extraction Duration",
          "description": "LLM extraction call duration percentiles",
          "transparent": false,
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 41
          },
          "repeatDirection": "h",
          "options": {
            "legend": {
              "displayMode": "table",
              "placement": "bottom",
              "showLegend": false,
              "calcs": [
                "mean",
                "max"
              ]
            },
            "tooltip": {
              "mode": "multi",
              "sort": "desc"
            }
          },
          "fieldConfig": {
            "defaults": {
              "unit": "s",
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "value": null,
                    "color": "green"
                  }
                ]
              },
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "drawStyle": "line",
                "lineWidth": 2,
                "fillOpacity": 10
              }
            },
            "overrides": []
          }
        },
        {
          "type": "timeseries",
          "targets": [
            {
              "expr": "spt:extraction_failures:rate5m",
              "legendFormat": "failures/s",
              "refId": "A"
            }
          ],
          "title": "Extraction Failures",
          "description": "LLM extraction failure rate per second",
          "transparent": false,
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 41
          },
          "repeatDirection": "h",
          "fieldConfig": {
            "defaults": {
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "value": null,
                    "color": "green"
                  },
                  {
                    "value": 0.01,
                    "color": "yellow"
                  },
                  {
                    "value": 0.1,
                    "color": "red"
                  }
                ]
              },
              "color": {
                "mode": "thresholds"
              },
              "custom": {
                "drawStyle": "line",
                "lineWidth": 2,
                "fillOpacity": 10
              }
            },
            "overrides": []
          }
        }
      ]
    },
    {
      "type": "row",
      "collapsed": true,
      "title": "Scoring",
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 49
      },
      "id": 0,
      "panels": [
        {
          "type": "bargauge",
          "targets": [
            {
              "expr": "sum(increase(spt_scoring_distribution_bucket{job=\"server-price-tracker\"}[1h])) by (le)",
              "legendFormat": "{{le}}",
              "refId": "A"
            }
          ],
          "title": "Score Distribution",
          "description": "Distribution of listing scores (0-100)",
          "transparent": false,
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "gridPos": {
            "h": 8,
            "w": 24,
            "x": 0,
            "y": 50
          },
          "repeatDirection": "h",
          "options": {
            "displayMode": "gradient",
            "valueMode": "color",
            "namePlacement": "auto",
            "showUnfilled": true,
            "sizing": "auto",
            "minVizWidth": 8,
            "minVizHeight": 16,
            "legend": {
              "displayMode": "list",
              "placement": "bottom",
              "showLegend": false,
              "calcs": []
            },
            "reduceOptions": {
              "calcs": []
            },
            "maxVizHeight": 300,
            "orientation": "horizontal"
          },
          "fieldConfig": {
            "defaults": {
              "min": 0,
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "value": null,
                    "color": "green"
                  }
                ]
              },
              "color": {
                "mode": "palette-classic"
              }
            },
            "overrides": []
          }
        }
      ]
    },
    {
      "type": "row",
      "collapsed": true,
      "title": "Alerts",
      "gridPos": {
        "h": 1,
        "w": 24,
        "x": 0,
        "y": 58
      },
      "id": 0,
      "panels": [
        {
          "type": "timeseries",
          "targets": [
            {
              "expr": "rate(spt_alerts_fired_total{job=\"server-price-tracker\"}[5m])",
              "legendFormat": "alerts/s",
              "refId": "A"
            }
          ],
          "title": "Alerts Fired Rate",
          "description": "Rate of alerts fired per second",
          "transparent": false,
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 0,
            "y": 59
          },
          "repeatDirection": "h",
          "fieldConfig": {
            "defaults": {
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "value": null,
                    "color": "green"
                  }
                ]
              },
              "color": {
                "mode": "palette-classic"
              },
              "custom": {
                "drawStyle": "line",
                "lineWidth": 2,
                "fillOpacity": 10
              }
            },
            "overrides": []
          }
        },
        {
          "type": "stat",
          "targets": [
            {
              "expr": "increase(spt_notification_failures_total{job=\"server-price-tracker\"}[24h])",
              "legendFormat": "",
              "refId": "A"
            }
          ],
          "title": "Notification Failures (24h)",
          "description": "Failed alert notification deliveries in the last 24 hours",
          "transparent": false,
          "datasource": {
            "type": "prometheus",
            "uid": "${datasource}"
          },
          "gridPos": {
            "h": 8,
            "w": 12,
            "x": 12,
            "y": 59
          },
          "repeatDirection": "h",
          "options": {
            "graphMode": "area",
            "colorMode": "background",
            "justifyMode": "auto",
            "textMode": "auto",
            "wideLayout": true,
            "showPercentChange": false,
            "reduceOptions": {
              "calcs": []
            },
            "percentChangeColorMode": "standard",
            "orientation": ""
          },
          "fieldConfig": {
            "defaults": {
              "thresholds": {
                "mode": "absolute",
                "steps": [
                  {
                    "value": null,
                    "color": "green"
                  },
                  {
                    "value": 1,
                    "color": "yellow"
                  },
                  {
                    "value": 5,
                    "color": "red"
                  }
                ]
              },
              "color": {
                "mode": "thresholds"
              }
            },
            "overrides": []
          }
        }
      ]
    }
  ],
  "templating": {
    "list": [
      {
        "type": "datasource",
        "name": "datasource",
        "label": "Datasource",
        "skipUrlSync": false,
        "query": "prometheus",
        "multi": false,
        "allowCustomValue": true,
        "includeAll": false,
        "auto": false,
        "auto_min": "10s",
        "auto_count": 30
      }
    ]
  },
  "annotations": {}
}
