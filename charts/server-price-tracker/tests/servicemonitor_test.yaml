---
suite: servicemonitor
templates:
  - templates/servicemonitor.yaml
tests:
  - it: does not render when serviceMonitor.enabled is false
    set:
      serviceMonitor.enabled: false
    asserts:
      - hasDocuments:
          count: 0

  - it: renders ServiceMonitor when enabled
    set:
      serviceMonitor.enabled: true
    asserts:
      - isKind:
          of: ServiceMonitor
      - equal:
          path: apiVersion
          value: monitoring.coreos.com/v1

  - it: has correct metrics path and interval
    set:
      serviceMonitor.enabled: true
    asserts:
      - equal:
          path: spec.endpoints[0].path
          value: /metrics
      - equal:
          path: spec.endpoints[0].interval
          value: 30s
