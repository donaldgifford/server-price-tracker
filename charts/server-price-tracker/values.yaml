---
replicaCount: 1

image:
  repository: ghcr.io/donaldgifford/server-price-tracker
  pullPolicy: IfNotPresent
  # Overrides the image tag whose default is the chart appVersion.
  tag: ""

imagePullSecrets: []
nameOverride: ""
fullnameOverride: ""

serviceAccount:
  create: true
  automount: true
  annotations: {}
  name: ""

podAnnotations: {}
podLabels: {}

podSecurityContext: {}
# fsGroup: 2000

securityContext: {}
# capabilities:
#   drop:
#   - ALL
# readOnlyRootFilesystem: true
# runAsNonRoot: true
# runAsUser: 1000

service:
  type: ClusterIP
  port: 8080

# -- Application configuration (mirrors Go Config struct).
# Non-secret values are rendered as literals. Secret values use ${ENV_VAR}
# placeholders resolved at runtime by os.ExpandEnv().
config:
  server:
    host: "0.0.0.0"
    port: 8080
    read_timeout: 30s
    write_timeout: 30s

  database:
    host: "${DB_HOST}"
    port: 5432
    name: "${DB_NAME}"
    user: "${DB_USER}"
    password: "${DB_PASSWORD}"
    sslmode: require
    pool_size: 10

  ebay:
    app_id: "${EBAY_APP_ID}"
    cert_id: "${EBAY_CERT_ID}"
    token_url: "${EBAY_TOKEN_URL}"
    browse_url: "${EBAY_BROWSE_URL}"
    marketplace: EBAY_US
    max_calls_per_cycle: 50
    rate_limit:
      per_second: 5
      burst: 10
      daily_limit: 5000

  llm:
    backend: ollama
    ollama:
      endpoint: "http://ollama.ollama.svc:11434"
      model: "mistral:7b-instruct-v0.3-q5_K_M"
    anthropic:
      model: ""
    openai_compat:
      endpoint: ""
      model: ""
    use_grammar: true
    concurrency: 4
    timeout: 30s

  scoring:
    weights:
      price: 0.40
      seller: 0.20
      condition: 0.15
      quantity: 0.10
      quality: 0.10
      time: 0.05
    min_baseline_samples: 10
    baseline_window_days: 90

  schedule:
    ingestion_interval: 30m
    baseline_interval: 6h
    stagger_offset: 30s

  notifications:
    discord:
      enabled: true
      webhook_url: "${DISCORD_WEBHOOK_URL}"

  logging:
    level: info
    format: json

# -- Secret management. Set create=true to render a Secret from values below.
# Set create=false and existingSecret to reference a user-managed Secret.
secret:
  create: true
  existingSecret: ""
  values:
    DB_HOST: "localhost"
    DB_NAME: "spt"
    DB_USER: "spt"
    DB_PASSWORD: ""
    EBAY_APP_ID: ""
    EBAY_CERT_ID: ""
    EBAY_TOKEN_URL: ""
    EBAY_BROWSE_URL: ""
    DISCORD_WEBHOOK_URL: ""
    ANTHROPIC_API_KEY: ""

# -- Migration init container
migration:
  enabled: true
  resources:
    requests:
      cpu: 50m
      memory: 64Mi
    limits:
      cpu: 200m
      memory: 128Mi

livenessProbe:
  httpGet:
    path: /healthz
    port: http
  initialDelaySeconds: 5
  periodSeconds: 15

readinessProbe:
  httpGet:
    path: /readyz
    port: http
  initialDelaySeconds: 3
  periodSeconds: 10

resources: {}
# requests:
#   cpu: 100m
#   memory: 128Mi
# limits:
#   cpu: 500m
#   memory: 256Mi

ingress:
  enabled: false
  className: ""
  annotations: {}
  hosts:
    - host: chart-example.local
      paths:
        - path: /
          pathType: ImplementationSpecific
  tls: []

httpRoute:
  enabled: false
  annotations: {}
  parentRefs:
    - group: gateway.networking.k8s.io
      kind: Gateway
      name: internal
      namespace: gateway
  hostnames:
    - chart-example.local
  rules:
    - matches:
        - path:
            type: PathPrefix
            value: /

autoscaling:
  enabled: false
  minReplicas: 1
  maxReplicas: 100
  targetCPUUtilizationPercentage: 80
  # targetMemoryUtilizationPercentage: 80

# -- Extra volumes and volumeMounts for user additions
volumes: []
volumeMounts: []

nodeSelector: {}
tolerations: []
affinity: {}

# -- Helm test hooks
tests:
  connection:
    enabled: true

# -- Prometheus ServiceMonitor
serviceMonitor:
  enabled: false
  interval: 30s
  path: /metrics
  labels: {}

# -- CloudNativePG PostgreSQL cluster
cnpg:
  enabled: false
  instances: 1
  imageName: ghcr.io/cloudnative-pg/postgresql:17.2
  bootstrap:
    database: spt
    owner: spt
  storage:
    size: 10Gi
    storageClass: ""
  monitoring:
    enablePodMonitor: false
    customQueriesConfigMap: []
    # - name: cnpg-default-monitoring
    #   key: queries
  managed:
    services:
      # Disable read-only and read replica services (single-instance doesn't need them)
      disabledDefaultServices: ["ro", "r"]
  postgresql:
    parameters:
      max_connections: "200"
      shared_buffers: "256MB"
      timezone: "UTC"
  resources:
    requests:
      cpu: 100m
      memory: 256Mi
    limits:
      cpu: "1"
      memory: 1Gi

# -- Ollama LLM backend (StatefulSet)
ollama:
  enabled: false
  image:
    repository: ollama/ollama
    tag: latest
    pullPolicy: IfNotPresent
  model: "mistral:7b-instruct-v0.3-q5_K_M"
  gpu:
    enabled: true
    count: 1
  nodeSelector:
    nvidia.com/gpu.present: "true"
  persistence:
    enabled: true
    size: 30Gi
    storageClass: ""
  resources:
    requests:
      cpu: "1"
      memory: 4Gi
    limits:
      cpu: "4"
      memory: 8Gi
